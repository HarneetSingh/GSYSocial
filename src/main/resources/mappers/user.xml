<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="com.motionapps.GSYSocial.dao.UserDao">

    <resultMap id="userMap" type="User" >
        <id column="email_id" property="emailId"  />
        <result column="user_name" property="userName"/>
        <result column="password" property="password" />
        <result column="date_of_birth" property="dateOfBirth"/>
        <result column="mobile_number" property="mobileNumber" />
        <result column="session_id" property="sessionId" />
        <result column="profile_pic" property="profilePicUrl" />
	</resultMap>   
 
    
 	<!-- ************** CREATE ************** -->
 	<insert id="createUser" parameterType="User" useGeneratedKeys="true">
		INSERT 
			INTO user
		SET 
			email_id = #{emailId},
			user_name = #{userName},
			password = #{password},
			date_of_birth = #{dateOfBirth},
			mobile_number = #{mobileNumber},
			profile_pic=#{profilePicUrl}
			session_id=#{sessionId};
 	</insert>   
	<!-- ************** READ ************** -->
    <select id="getUsers" resultMap="userMap">
        SELECT
        	email_id,
        	user_name,
        	password,
        	date_of_birth,
        	mobile_number,
        	profile_pic,
        	session_id
        FROM
            user; 	            	
    </select>
    <select id="getUser" resultMap="userMap" parameterType="String">
        SELECT
        	email_id,
        	user_name,
        	date_of_birth,
        	mobile_number,
        	profile_pic,
        	session_id
        FROM
            user
        WHERE
        	email_id=#{value};          	
    </select>
    <select id="searchUser" resultMap="userMap" parameterType="String">
        SELECT
        	email_id,
        	user_name,
        	date_of_birth,
        	mobile_number,
        	profile_pic
        FROM
            user
        WHERE
        	email_id LIKE #{value%}
       	OR
       		user_name LIKE #{value%};        	
    </select>
    <select id="getSessionId" resultType="String" parameterType="String">
        SELECT
        	session_id
        FROM
            user
        WHERE      
        	email_id=#{value}; 	            	
    </select>
    <select id="getPassword" resultType="String" parameterType="String">
        SELECT
        	password
        FROM
            user
        WHERE      
        	email_id=#{value}; 	            	
    </select>
    
    <select id="checkIfEmailIdAlreadyExists" resultType="Int" parameterType="String">
        SELECT
        	count(*)
        FROM
            user
        WHERE      
        	email_id=#{value}; 	            	
    </select>
	
    <select id="checkIfUserNameAlreadyExists" resultType="Int" parameterType="String">
        SELECT
        	count(*)
        FROM
            user
        WHERE      
        	user_name=#{value}; 	            	
    </select>
    
	     	
 	<!-- ************** UPDATE ************** -->
 	<update id="updateSessionId" parameterType="User">
		UPDATE 
			user
		SET 
			session_id = #{sessionId}
		WHERE
			email_id = #{emailId}
 	</update>  
 	
 	<update id="updateUser" parameterType="User">
		UPDATE 
			user
		SET 
			email_id = #{emailId}
			<if test="userName != null">
				,user_name = #{userName}
			</if>
			<if test="dateOfBirth != null">
				,date_of_birth = #{dateOfBirth}
			</if>
			<if test="mobileNumber != null">
				,mobile_number = #{mobileNumber}
			</if>
			<if test="profilePicUrl != null">
				,profile_pic = #{profilePicUrl}
			</if>	
		WHERE
			email_id = #{emailId}
 	</update>  
 	
			
 	
</mapper>